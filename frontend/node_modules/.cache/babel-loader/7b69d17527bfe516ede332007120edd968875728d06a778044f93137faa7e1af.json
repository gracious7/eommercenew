{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/princ/Desktop/eommercenew/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/princ/Desktop/eommercenew/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/princ/Desktop/eommercenew/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from\"react\";import{PaymentElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import{useSelector}from'react-redux';import{selectCurrentOrder}from\"../features/order/orderSlice\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function CheckoutForm(){var stripe=useStripe();var elements=useElements();var currentOrder=useSelector(selectCurrentOrder);var _useState=useState(null),_useState2=_slicedToArray(_useState,2),message=_useState2[0],setMessage=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];useEffect(function(){if(!stripe){return;}var clientSecret=new URLSearchParams(window.location.search).get(\"payment_intent_client_secret\");if(!clientSecret){return;}stripe.retrievePaymentIntent(clientSecret).then(function(_ref){var paymentIntent=_ref.paymentIntent;switch(paymentIntent.status){case\"succeeded\":setMessage(\"Payment succeeded!\");break;case\"processing\":setMessage(\"Your payment is processing.\");break;case\"requires_payment_method\":setMessage(\"Your payment was not successful, please try again.\");break;default:setMessage(\"Something went wrong.\");break;}});},[stripe]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _yield$stripe$confirm,error;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:setIsLoading(true);_context.next=6;return stripe.confirmPayment({elements:elements,confirmParams:{// Make sure to change this to your payment completion page\nreturn_url:\"https://mern-ecommerce-lyart.vercel.app/order-success/\".concat(currentOrder.id)}});case 6:_yield$stripe$confirm=_context.sent;error=_yield$stripe$confirm.error;// This point will only be reached if there is an immediate error when\n// confirming the payment. Otherwise, your customer will be redirected to\n// your `return_url`. For some payment methods like iDEAL, your customer will\n// be redirected to an intermediate site first to authorize the payment, then\n// redirected to the `return_url`.\nif(error.type===\"card_error\"||error.type===\"validation_error\"){setMessage(error.message);}else{setMessage(\"An unexpected error occurred.\");}setIsLoading(false);case 10:case\"end\":return _context.stop();}},_callee);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var paymentElementOptions={layout:\"tabs\"};return/*#__PURE__*/_jsxs(\"form\",{id:\"payment-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(PaymentElement,{id:\"payment-element\",options:paymentElementOptions}),/*#__PURE__*/_jsx(\"button\",{disabled:isLoading||!stripe||!elements,id:\"submit\",children:/*#__PURE__*/_jsx(\"span\",{id:\"button-text\",children:isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"spinner\",id:\"spinner\"}):\"Pay now\"})}),message&&/*#__PURE__*/_jsx(\"div\",{id:\"payment-message\",children:message})]});}","map":{"version":3,"names":["React","useEffect","useState","PaymentElement","useStripe","useElements","useSelector","selectCurrentOrder","jsx","_jsx","jsxs","_jsxs","CheckoutForm","stripe","elements","currentOrder","_useState","_useState2","_slicedToArray","message","setMessage","_useState3","_useState4","isLoading","setIsLoading","clientSecret","URLSearchParams","window","location","search","get","retrievePaymentIntent","then","_ref","paymentIntent","status","handleSubmit","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","_yield$stripe$confirm","error","wrap","_callee$","_context","prev","next","preventDefault","abrupt","confirmPayment","confirmParams","return_url","concat","id","sent","type","stop","_x","apply","arguments","paymentElementOptions","layout","onSubmit","children","options","disabled","className"],"sources":["C:/Users/princ/Desktop/eommercenew/frontend/src/pages/CheckoutForm.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport {\r\n  PaymentElement,\r\n  useStripe,\r\n  useElements\r\n} from \"@stripe/react-stripe-js\";\r\nimport { useSelector } from 'react-redux';\r\nimport { selectCurrentOrder } from \"../features/order/orderSlice\";\r\n\r\nexport default function CheckoutForm() {\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const currentOrder = useSelector(selectCurrentOrder);\r\n\r\n  const [message, setMessage] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!stripe) {\r\n      return;\r\n    }\r\n\r\n    const clientSecret = new URLSearchParams(window.location.search).get(\r\n      \"payment_intent_client_secret\"\r\n    );\r\n\r\n    if (!clientSecret) {\r\n      return;\r\n    }\r\n\r\n    stripe.retrievePaymentIntent(clientSecret).then(({ paymentIntent }) => {\r\n      switch (paymentIntent.status) {\r\n        case \"succeeded\":\r\n          setMessage(\"Payment succeeded!\");\r\n          break;\r\n        case \"processing\":\r\n          setMessage(\"Your payment is processing.\");\r\n          break;\r\n        case \"requires_payment_method\":\r\n          setMessage(\"Your payment was not successful, please try again.\");\r\n          break;\r\n        default:\r\n          setMessage(\"Something went wrong.\");\r\n          break;\r\n      }\r\n    });\r\n  }, [stripe]);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!stripe || !elements) {\r\n      // Stripe.js hasn't yet loaded.\r\n      // Make sure to disable form submission until Stripe.js has loaded.\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n\r\n    const { error } = await stripe.confirmPayment({\r\n      elements,\r\n      confirmParams: {\r\n        // Make sure to change this to your payment completion page\r\n        return_url: `https://mern-ecommerce-lyart.vercel.app/order-success/${currentOrder.id}`,\r\n      },\r\n    });\r\n\r\n    // This point will only be reached if there is an immediate error when\r\n    // confirming the payment. Otherwise, your customer will be redirected to\r\n    // your `return_url`. For some payment methods like iDEAL, your customer will\r\n    // be redirected to an intermediate site first to authorize the payment, then\r\n    // redirected to the `return_url`.\r\n    if (error.type === \"card_error\" || error.type === \"validation_error\") {\r\n      setMessage(error.message);\r\n    } else {\r\n      setMessage(\"An unexpected error occurred.\");\r\n    }\r\n\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const paymentElementOptions = {\r\n    layout: \"tabs\"\r\n  }\r\n\r\n  return (\r\n    <form id=\"payment-form\" onSubmit={handleSubmit}>\r\n      <PaymentElement id=\"payment-element\" options={paymentElementOptions} />\r\n      <button disabled={isLoading || !stripe || !elements} id=\"submit\">\r\n        <span id=\"button-text\">\r\n          {isLoading ? <div className=\"spinner\" id=\"spinner\"></div> : \"Pay now\"}\r\n        </span>\r\n      </button>\r\n      {/* Show any error or success messages */}\r\n      {message && <div id=\"payment-message\">{message}</div>}\r\n    </form>\r\n  );\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}